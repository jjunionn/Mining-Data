import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.decomposition import PCA
from sklearn.preprocessing import LabelEncoder
from sklearn.cluster import KMeans
from google.colab import files

# Upload file manual dari komputer
uploaded = files.upload()

# ==== LOAD DATA ====
df = pd.read_csv("loan.csv", sep=";")
print("Data asli:")
print(df.head())

# ==== ENCODING ====
le = LabelEncoder()
df["Pekerjaan"] = le.fit_transform(df["Pekerjaan"])
df["Pinjaman_Disetuju"] = le.fit_transform(df["Pinjaman_Disetuju"])  # ubah Ya/Tidak jadi 1/0

print("\nData setelah encoding:")
print(df.head())

# ==== FITUR ====
# Hanya pakai variabel independen (tanpa label)
X = df[["Penghasilan", "Pekerjaan", "Umur"]]

# ==== ALGORITMA UNSUPERVISED: KMeans ====
kmeans = KMeans(n_clusters=2, random_state=42, n_init=10)
kmeans.fit(X)

# Ambil hasil cluster
labels = kmeans.labels_
df["Cluster"] = labels

print("\nData dengan hasil cluster:")
print(df.head(10))

# ==== VISUALISASI PCA ====
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X)

plt.figure(figsize=(8,6))
plt.scatter(X_pca[:,0], X_pca[:,1], c=labels, cmap="viridis", edgecolor="k", s=80)
plt.xlabel("PC1")
plt.ylabel("PC2")
plt.title("Visualisasi PCA - KMeans Clustering")
plt.colorbar(label="Cluster")
plt.show()
